import{defineProperty as t}from"../../_virtual/_rollupPluginBabelHelpers.min.mjs";import{createCanvasElement as e}from"../util/misc/dom.min.mjs";import{BaseFilter as a}from"./BaseFilter.min.mjs";import{isWebGLPipelineState as r}from"./utils.min.mjs";import{classRegistry as i}from"../ClassRegistry.min.mjs";import{fragmentSource as s}from"./shaders/blur.min.mjs";const o={blur:0,mainParameter:"blur"};class l extends a{getFragmentSource(){return s}applyTo(t){r(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){t.imageData=this.simpleBlur(t)}simpleBlur(t){let{ctx:a,imageData:r,filterBackend:{resources:i}}=t;const{width:s,height:o}=r;i.blurLayer1||(i.blurLayer1=e(),i.blurLayer2=e());const l=i.blurLayer1,h=i.blurLayer2;l.width===s&&l.height===o||(h.width=l.width=s,h.height=l.height=o);const m=l.getContext("2d"),n=h.getContext("2d"),p=15,u=.06*this.blur*.5;let g,c,d,b;for(m.putImageData(r,0,0),n.clearRect(0,0,s,o),b=-15;b<=p;b++)g=(Math.random()-.5)/4,c=b/p,d=u*c*s+g,n.globalAlpha=1-Math.abs(c),n.drawImage(l,d,g),m.drawImage(h,0,0),n.globalAlpha=1,n.clearRect(0,0,h.width,h.height);for(b=-15;b<=p;b++)g=(Math.random()-.5)/4,c=b/p,d=u*c*o+g,n.globalAlpha=1-Math.abs(c),n.drawImage(l,g,d),m.drawImage(h,0,0),n.globalAlpha=1,n.clearRect(0,0,h.width,h.height);a.drawImage(l,0,0);const f=a.getImageData(0,0,l.width,l.height);return m.globalAlpha=1,m.clearRect(0,0,l.width,l.height),f}getUniformLocations(t,e){return{delta:t.getUniformLocation(e,"uDelta")}}sendUniformData(t,e){const a=this.chooseRightDelta();t.uniform2fv(e.delta,a)}chooseRightDelta(){let t=1;const e=[0,0];this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio);const a=t*this.blur*.12;return this.horizontal?e[0]=a:e[1]=a,e}}t(l,"type","Blur"),t(l,"defaults",o),i.setClass(l);export{l as Blur,o as blurDefaultValues};
//# sourceMappingURL=Blur.min.mjs.map
