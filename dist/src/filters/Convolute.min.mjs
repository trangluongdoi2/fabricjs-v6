import{defineProperty as t,objectSpread2 as e}from"../../_virtual/_rollupPluginBabelHelpers.min.mjs";import{BaseFilter as a}from"./BaseFilter.min.mjs";import{classRegistry as o}from"../ClassRegistry.min.mjs";import{fragmentSource as r}from"./shaders/convolute.min.mjs";const i={opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]};class s extends a{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return r[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,a=e.data,o=this.matrix,r=Math.round(Math.sqrt(o.length)),i=Math.floor(r/2),s=e.width,n=e.height,m=t.ctx.createImageData(s,n),u=m.data,c=this.opaque?1:0;let f,h,p,l,g,x,d,q,j,y,M,S,U;for(M=0;M<n;M++)for(y=0;y<s;y++){for(g=4*(M*s+y),f=0,h=0,p=0,l=0,U=0;U<r;U++)for(S=0;S<r;S++)d=M+U-i,x=y+S-i,d<0||d>=n||x<0||x>=s||(q=4*(d*s+x),j=o[U*r+S],f+=a[q]*j,h+=a[q+1]*j,p+=a[q+2]*j,c||(l+=a[q+3]*j));u[g]=f,u[g+1]=h,u[g+2]=p,u[g+3]=c?a[g+3]:l}t.imageData=m}getUniformLocations(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return e(e({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}t(s,"type","Convolute"),t(s,"defaults",i),o.setClass(s);export{s as Convolute,i as convoluteDefaultValues};
//# sourceMappingURL=Convolute.min.mjs.map
